# AciTrack Backend API

A production-ready FastAPI service that exposes academic publication data from Google Drive for consumption by Custom GPT Actions.

## Overview

AciTrack Backend provides HTTPS endpoints to access the latest academic publication reports, manifests, and CSV data generated by the AciTrack system. The data is stored in Google Drive and accessed via a service account.

## Features

- ✅ **Simple REST API** - Three GET endpoints for easy access
- ✅ **Google Drive Integration** - Automatic file retrieval from Google Drive
- ✅ **Custom GPT Ready** - OpenAPI 3.0.1 schema included
- ✅ **Production Deploy** - Ready for Railway or Render
- ✅ **Health Monitoring** - Built-in health check endpoint
- ✅ **CORS Configured** - Secure access from OpenAI domains
- ✅ **Zero Per-User Auth** - Service account based authentication

## Quick Start

### Prerequisites

- Python 3.11+
- Google Cloud Service Account with Drive API access
- Google Drive folder ID containing the files

### Local Development

1. **Clone the repository**
   ```bash
   git clone <repository-url>
   cd acitracker_backend
   ```

2. **Create virtual environment**
   ```bash
   python -m venv venv
   source venv/bin/activate  # On Windows: venv\Scripts\activate
   ```

3. **Install dependencies**
   ```bash
   pip install -r requirements.txt
   ```

4. **Set environment variables**
   ```bash
   export ACITRACK_DRIVE_FOLDER_ID="your-folder-id"
   export ACITRACK_GCP_SA_JSON='{"type":"service_account",...}'
   ```

5. **Run the server**
   ```bash
   python main.py
   ```

6. **Test locally**
   ```bash
   curl http://localhost:8000/health
   curl http://localhost:8000/report
   ```

## API Endpoints

### `GET /`
Returns API information and available endpoints.

**Response**: `application/json`

### `GET /health`
Health check endpoint for monitoring service status.

**Response**: `application/json`
```json
{
  "status": "healthy",
  "drive_connected": true,
  "folder_name": "AciTrack Outputs",
  "folder_id": "abc123..."
}
```

### `GET /report`
Returns the latest academic publication report in Markdown format.

**Response**: `text/markdown`

**File**: `latest_report.md`

### `GET /manifest`
Returns the latest manifest with publication metadata.

**Response**: `application/json`

**File**: `latest_manifest.json`

### `GET /new`
Returns CSV of newly discovered publications.

**Response**: `text/csv`

**File**: `latest_new.csv`

## Deployment

See **[DEPLOYMENT.md](DEPLOYMENT.md)** for detailed deployment instructions for:
- Railway (recommended)
- Render

## Custom GPT Integration

1. Deploy the backend to Railway or Render
2. Copy your deployment URL
3. Update `openapi.json` with your server URL
4. In ChatGPT → GPT Builder → Actions:
   - Paste the contents of `openapi.json`
   - Save
5. Test your Custom GPT

## Project Structure

```
acitracker_backend/
├── main.py              # FastAPI application
├── requirements.txt     # Python dependencies
├── openapi.json        # OpenAPI schema for Custom GPT
├── DEPLOYMENT.md       # Deployment guide
├── SECURITY.md         # Security documentation
├── README.md           # This file
└── .gitignore          # Git ignore rules
```

## Configuration

### Environment Variables

| Variable | Required | Description |
|----------|----------|-------------|
| `ACITRACK_DRIVE_FOLDER_ID` | Yes | Google Drive folder ID containing output files |
| `ACITRACK_GCP_SA_JSON` | Yes | Service account JSON as a single-line string |
| `PORT` | No | Port to run server (default: 8000, auto-set by platforms) |

### Required Files in Google Drive

The Google Drive folder must contain these exact filenames:
- `latest_report.md`
- `latest_manifest.json`
- `latest_new.csv`

## Security

- Service account has **read-only** access to Google Drive
- HTTPS enforced by deployment platform
- CORS configured for OpenAI domains only
- No sensitive data in responses

See **[SECURITY.md](SECURITY.md)** for comprehensive security documentation.

## Architecture

```
┌─────────────┐
│ Custom GPT  │
└──────┬──────┘
       │ HTTPS
       ▼
┌─────────────────┐
│  FastAPI Server │
│  (Railway/      │
│   Render)       │
└────────┬────────┘
         │ Google Drive API
         ▼
┌──────────────────┐
│  Google Drive    │
│  Folder          │
│  ├── latest_     │
│  │   report.md   │
│  ├── latest_     │
│  │   manifest.json│
│  └── latest_new.csv│
└──────────────────┘
```

## Monitoring

### Health Check

Monitor service health by pinging:
```bash
curl https://your-app-url/health
```

### Uptime Monitoring

Set up free monitoring with:
- [UptimeRobot](https://uptimerobot.com)
- [Better Uptime](https://betteruptime.com)

Configure to check `/health` every 5 minutes.

## Troubleshooting

### Common Issues

**"File not found in Google Drive folder"**
- Verify folder ID is correct
- Check files exist with exact names
- Ensure service account has viewer access to folder

**"Invalid JSON in ACITRACK_GCP_SA_JSON"**
- Ensure JSON is valid and properly escaped
- Copy entire service account JSON as single line
- Remove any line breaks or extra whitespace

**"Google Drive API error: 403"**
- Service account needs read access
- Share folder with service account email
- Check service account has Drive API enabled

See [DEPLOYMENT.md](DEPLOYMENT.md) for more troubleshooting tips.

## Performance

### Response Times
- Cold start (free tier): 10-30 seconds
- Warm requests: 200-500ms
- Drive API latency: 100-300ms

### Optimization Opportunities
- Add caching (Redis) to reduce Drive API calls
- Upgrade to paid tier to eliminate cold starts
- Implement CDN for static content

## Cost Estimates

### Railway
- Free tier: $5/month credit (sufficient for low traffic)
- Paid tier: ~$10-20/month for production

### Render
- Free tier: 750 hours/month (sufficient for demo)
- Paid tier: ~$7-15/month for production

### Google Cloud
- Drive API: Free (within quota limits)
- Storage: Free (minimal data)

## Roadmap

### Phase 1: MVP (Current)
- ✅ Basic API endpoints
- ✅ Google Drive integration
- ✅ OpenAPI schema
- ✅ Deployment ready

### Phase 2: Enhancements
- [ ] Request logging
- [ ] Response caching
- [ ] Rate limiting
- [ ] API key authentication

### Phase 3: Production
- [ ] Monitoring & alerts
- [ ] Automatic key rotation
- [ ] Custom domain
- [ ] Performance optimization

## Contributing

This is an internal SpotItEarly project. For changes:

1. Create a feature branch
2. Make your changes
3. Test locally
4. Deploy to staging (if available)
5. Create pull request

## Support

For issues:
1. Check [DEPLOYMENT.md](DEPLOYMENT.md) troubleshooting section
2. Review platform logs (Railway/Render dashboard)
3. Test `/health` endpoint
4. Contact team lead

## License

Internal use only - SpotItEarly

## Credits

Built with:
- [FastAPI](https://fastapi.tiangolo.com/) - Modern Python web framework
- [Google Drive API](https://developers.google.com/drive) - File storage
- [Railway](https://railway.app) / [Render](https://render.com) - Deployment platforms

---

**Status**: ✅ Production Ready

**Last Updated**: 2025-12-26

**Maintained By**: SpotItEarly Engineering Team
